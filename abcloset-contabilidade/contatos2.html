<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contatos - WhatsApp Mockup</title>
</head>
<body>
<style>
  .contacts-app{
    width:100%; height:100%;
    display:flex; flex-direction:column;
    background: linear-gradient(#0b8450, #075f3a);
    color:#fff; padding:10px; box-sizing:border-box;
    border-radius:16px; overflow:hidden;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  .contacts-header{display:flex;align-items:center;justify-content:center;position:relative;padding:8px 4px;}
  .contacts-header h2{margin:0;font-size:1.05rem;}
  .back-btn{position:absolute;left:6px;background:transparent;border:none;color:white;font-size:1.3rem;cursor:pointer;}
  .add-btn{position:absolute;right:6px;background:rgba(255,255,255,0.12);border:none;color:white;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:1.05rem;}
  .contacts-search{padding:8px 4px;}
  #contacts-search-input{width:100%;padding:8px 10px;border-radius:10px;border:none;outline:none;box-sizing:border-box;font-size:0.95rem;}
  .contacts-list{flex:1;overflow:auto;padding:6px;display:flex;flex-direction:column;gap:8px;margin-top:6px;}
  .contact-item{display:flex;gap:10px;align-items:center;background:rgba(255,255,255,0.06);padding:8px;border-radius:12px;cursor:pointer;transition:transform .12s;}
  .contact-item:hover{transform:translateY(-2px);}
  .contact-thumb{width:56px;height:56px;min-width:56px;border-radius:12px;z-index: 1;overflow:hidden;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.08);color:#fff;font-weight:700;}
  .contact-thumb img{width:100%;height:100%;object-fit:cover;display:block;z-index: 1;}
  .contact-thumb {
    width:56px;
    height:56px;
    min-width:56px;
    border-radius:50%; /* círculo */
    z-index: 1;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(255,255,255,0.08);
    color:#fff;
    font-weight:700;
    border: 2px solid transparent; /* borda padrão */
    transition: border 0.3s ease;
  }
  
  .contact-thumb.new-status {
    border: 2px solid #25D366; /* verde WhatsApp */
    animation: pulse 1.2s infinite alternate;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.08); }
    100% { transform: scale(1); }
  }

  .contact-info{flex:1;display:flex;flex-direction:column;}
  .contact-name{font-size:1rem;font-weight:600;}
  .contact-number{font-size:0.82rem;opacity:0.9;}
  .contact-actions{display:flex;gap:8px;align-items:center;margin-left:8px;}
  .icon-btn{background:transparent;border:none;color:rgba(255,255,255,0.95);cursor:pointer;font-size:1.05rem;padding:6px;border-radius:8px;}
  .icon-btn.danger{color:rgba(255,200,200,0.95);}
  .contacts-modal{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index: 9999;}
  .contacts-modal.hidden{display:none;}
  .contacts-modal-card{width:86%;max-width:420px;background:white;color:#111;border-radius:12px;padding:14px;box-sizing:border-box;}
  .contacts-modal-card h3{margin-top:0;}
  .contacts-modal-card label{display:block;font-size:0.85rem;margin:8px 0;}
  .contacts-modal-card input{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;box-sizing:border-box;}
  .modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px;}
  .btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;}
  .btn.primary{background:#0b8450;color:white;}
  .photo-preview{display:flex;justify-content:center;align-items:center;margin:8px auto;width:80px;height:80px;border-radius:50%;background:#f0f0f0;overflow:hidden;font-size:4rem;}
  .emoji-picker{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0;justify-content:center;}
  .emoji-picker span{cursor:pointer;font-size:1.5rem;transition:transform .1s;}
  .emoji-picker span:hover{transform:scale(1.2);}

  .story-item { min-width:100%; transition:transform 0.3s ease; display:flex; justify-content:center; align-items:center; }
  .story-item img, .story-item video { width:100%; height:auto; max-height:600px; border-radius:12px; object-fit:cover; }
  #stories-modal {
    backdrop-filter: blur(6px);
    transition: opacity 0.2s ease;
  }
  #stories-modal.hidden {
    opacity: 0;
    pointer-events: none;
  }
  .story-progress-bar {
    flex:1;
    background: rgba(255,255,255,0.3);
    border-radius:2px;
    overflow:hidden;
  }
  
  .story-progress-fill {
    width:0%;
    height:100%;
    background:#25D366;
    transition: width 0.1s linear;
  }
  .locked {
    cursor: not-allowed;
    opacity: 0.5;
  }


</style>

<div id="contacts-app" class="contacts-app">
  <div class="contacts-header">
    <button id="contacts-back" class="back-btn">←</button>
    <h2>Contatos</h2>
    <button id="contacts-add" class="add-btn">＋</button>
  </div>
  <!-- Stories Modal -->
  <div id="stories-modal" class="contacts-modal hidden" style="position:fixed;inset:0;background:black;z-index:9999;">
    <div id="stories-container" style="position:relative;width:100%;height:100%;overflow:hidden;display:flex;align-items:center;justify-content:center;">
      <!-- Barra de progresso -->
      <div id="stories-progress"
           style="display:flex;gap:4px;position:absolute;top:16px;left:16px;right:16px;height:4px;z-index:10;"></div>
      
      <!-- Botão de voltar -->
      <button id="stories-back"
              style="position:absolute;top:28px;left:16px;background:none;border:none;color:white;font-size:1.8rem;cursor:pointer;z-index:10;">←</button>
  
      <!-- Área dos stories -->
      <div id="stories-carousel"
           style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;overflow:hidden;"></div>
  
      <!-- Legenda -->
      <div id="stories-caption"
           style="position:absolute;bottom:0;left:0;right:0;padding:12px 16px;background:rgba(0,0,0,0.45);color:white;font-size:1rem;z-index:10;"></div>
    </div>
  </div>

  <div class="contacts-search">
    <input id="contacts-search-input" type="search" placeholder="Procurar..."/>
  </div>

  <div id="contacts-list" class="contacts-list"></div>

  <!-- Modal -->
  <div id="contacts-modal" class="contacts-modal hidden">
    
    <div class="contacts-modal-card">
      <h3 id="modal-title">Adicionar Contato</h3>

      <label>Nome
        <input id="contact-name" type="text" placeholder="Ex: João Silva"/>
      </label>
      <label>Número (ex: 5585995598888)
        <input id="contact-number" type="text" placeholder="Código do país + DDD + número"/>
      </label>

      <div class="photo-preview" id="photo-preview">👤</div>

      <div style="text-align:center;display:flex;justify-content:center;gap:10px;">
        <button id="btn-photo" class="btn">📷 Foto</button>
        <button id="btn-emoji" class="btn">😎 Emoji</button>
        <input type="file" id="photo-input" accept="image/*" capture="user" style="display:none;">
      </div>

      <div id="emoji-picker" class="emoji-picker" style="display:none;">
        <span>😎</span><span>😀</span><span>😁</span><span>❤️</span><span>💩</span><span>😅</span><span>🐱</span><span>🤢</span><span>🤮</span>
        <span>😻</span><span>🧐</span><span>😠</span><span>😡</span><span>🙈
        <span>🙉</span><span>🙊</span><span>🧒</span><span>👦</span><span>👧</span><span>🧑</span><span>👱</span><span>👨</span><span>🧔</span>
        </span><span>👨‍🦰</span><span>👨‍🦱</span><span>👨‍🦳</span><span>👨‍🦲</span>
        <span>👩</span><span>👩‍🦰</span><span>👩‍🦱</span><span>👩‍🦳</span><span>👧</span><span>🧓</span><span>👴</span><span>👵</span><span>⚽</span>
      </div>
    
      <div class="modal-actions">
        <button id="modal-save" class="btn primary">Salvar</button>
        <button id="modal-cancel" class="btn">Cancelar</button>
      </div>
    </div>
  </div>
  

</div>


<!-- ... código HTML e CSS permanece igual até <script> ... -->

<script>
(function(){
    const STORAGE_KEY = 'contactsApp.v2';
    const listEl = document.getElementById('contacts-list');
    const modal = document.getElementById('contacts-modal');
    const inputName = document.getElementById('contact-name');
    const inputNumber = document.getElementById('contact-number');
    const saveBtn = document.getElementById('modal-save');
    const cancelBtn = document.getElementById('modal-cancel');
    const addBtn = document.getElementById('contacts-add');
    const backBtn = document.getElementById('contacts-back');
    const searchInput = document.getElementById('contacts-search-input');
    const btnPhoto = document.getElementById('btn-photo');
    const btnEmoji = document.getElementById('btn-emoji');
    const photoInput = document.getElementById('photo-input');
    const preview = document.getElementById('photo-preview');
    const emojiPicker = document.getElementById('emoji-picker');
    // --- Stories ---
    const storiesModal = document.getElementById('stories-modal');
    const storiesCarousel = document.getElementById('stories-carousel');
    const storiesCaption = document.getElementById('stories-caption');
    const storiesClose = document.getElementById('stories-close');
    const storiesPrev = document.getElementById('stories-prev');
    const storiesNext = document.getElementById('stories-next');
    const storiesProgress = document.getElementById('stories-progress');
    const storiesBack = document.getElementById('stories-back');
  
    let contacts = [];
    let editingId = null;
    let currentPhoto = '';
    let storyTimer = null;
    let paused = false;
    let elapsed = 0;
    let duration = 0;
    let currentStories = [];
    let currentStoryIndex = 0;
    let currentVideo = null;
    const STORY_DURATION = 5000; // 5s para imagens
  
   
    const defaultContacts = [];
  
    function genId(){return 'c_'+Math.random().toString(36).slice(2,9);}
    function load(){contacts = JSON.parse(localStorage.getItem(STORAGE_KEY)||'null')||defaultContacts;}
    function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(contacts));}
    function normalizeNumber(raw){return String(raw||'').replace(/\D/g,'');}
  
    async function loadNetworking(){
      try {
        const res = await fetch('./networking/contatos.json', {cache:'no-store'});
        if(!res.ok) throw new Error('Arquivo não encontrado');
        const networkContacts = await res.json();
        let added = 0;
        networkContacts.forEach(nc=>{
          const exists = contacts.some(c=>normalizeNumber(c.number)===normalizeNumber(nc.number));
          if(!exists){
            contacts.push({
              id: genId(),
              name: nc.name || '(sem nome)',
              number: normalizeNumber(nc.number || ''),
              photo: nc.photo || './user.png',
              fav: false,
              status: nc.status || [],
              system: true
            });
            
            // 🔒 Protege o objeto de qualquer modificação
            Object.freeze(sysContact);

            added++;
          }
        });
        if(added>0){ save(); renderList(searchInput.value.trim()); }
        console.log(`🌐 Networking atualizado (${added} novos contatos).`);
      } catch(err){ console.log('⚠️ Nenhum networking carregado:', err.message); }
    }
  
    function renderContact(c) {
      const el = document.createElement('div');
      el.className = 'contact-item';
      el.dataset.id = c.id;
    
      const thumb = document.createElement('div');
      thumb.className = 'contact-thumb';
      
      // Marca como "novo status" se houver stories não vistos
      if (c.status && c.status.length > 0 && !c.statusViewed) {
        thumb.classList.add('new-status');
      }
    
      // Exibe emoji ou imagem
      if (/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1FAFF}]/u.test(c.photo)) {
        thumb.textContent = c.photo;
        thumb.style.fontSize = '1.8rem';
      } else {
        const img = document.createElement('img');
        img.src = c.photo || './user.png';
        img.onerror = () => { img.src = './user.png'; };
        thumb.appendChild(img);
      }
    
      // Informações do contato
      const info = document.createElement('div');
      info.className = 'contact-info';
      const nm = document.createElement('div');
      nm.className = 'contact-name';
      nm.textContent = c.name || '(sem nome)';
      const no = document.createElement('div');
      no.className = 'contact-number';
      no.textContent = c.number;
      info.appendChild(nm);
      info.appendChild(no);
    
      // Ações do contato
      const actions = document.createElement('div');
      actions.className = 'contact-actions';
    
      // Botão de favorito (sempre permitido)
      const favBtn = document.createElement('button');
      favBtn.className = 'icon-btn';
      favBtn.title = 'Favoritar';
      favBtn.innerHTML = c.fav ? '⭐' : '☆';
      favBtn.addEventListener('click', ev => {
        ev.stopPropagation();
        toggleFav(c.id);
      });
      actions.appendChild(favBtn);
    
      // Contatos do sistema → bloqueados para edição/exclusão
     if (c.system) {
        const lockEdit = document.createElement('button');
        lockEdit.className = 'icon-btn locked';
        lockEdit.title = 'Edição bloqueada';
        lockEdit.textContent = '🔒';
        lockEdit.addEventListener('click', ev => {
          ev.stopPropagation();
          alert('⚠️ Este contato é parte de nossa "NetWorking" e não pode ser editado.');
        });
      
        const lockDel = document.createElement('button');
        lockDel.className = 'icon-btn locked';
        lockDel.title = 'Exclusão bloqueada';
        lockDel.textContent = '🔒';
        lockDel.addEventListener('click', ev => {
          ev.stopPropagation();
          alert('⚠️ Este contato é parte de nossa "NetWorking" e não pode ser excluído.');
        });
      
        actions.appendChild(lockEdit);
        actions.appendChild(lockDel);

       

      } else {
        // Contatos normais → editar/excluir permitidos
        const editBtn = document.createElement('button');
        editBtn.className = 'icon-btn';
        editBtn.title = 'Editar';
        editBtn.innerHTML = '✎';
        editBtn.addEventListener('click', ev => {
          ev.stopPropagation();
          openEdit(c.id);
        });
    
        const delBtn = document.createElement('button');
        delBtn.className = 'icon-btn danger';
        delBtn.title = 'Excluir';
        delBtn.innerHTML = '🗑';
        delBtn.addEventListener('click', ev => {
          ev.stopPropagation();
          removeContact(c.id);
        });
    
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
      }
    
      // Montagem final
      el.appendChild(thumb);
      el.appendChild(info);
      el.appendChild(actions);
    
      // Clique geral → abrir WhatsApp
      el.addEventListener('click', () => {
        const num = normalizeNumber(c.number);
        if (!num) return alert('Número inválido');
        window.open(`https://wa.me/${num}`, '_blank');
      });
    
      // Clique na miniatura → abrir stories
      thumb.addEventListener('click', ev => {
        ev.stopPropagation();
        openStories(c);
      });
    
      listEl.appendChild(el);
    }

  
    
  
   
    function openStories(contact){
      if(!contact.status || contact.status.length===0) return;
      contact.statusViewed = true;
      save();
      localStorage.setItem('contactsApp.v2', JSON.stringify(contacts));
      renderList(document.getElementById('contacts-search-input').value.trim());
      currentStories = contact.status;
      currentStoryIndex = 0;
      renderCurrentStory();
      storiesModal.classList.remove('hidden');
    }
     function renderStoryProgress(){
      storiesProgress.innerHTML = '';
      currentStories.forEach((_, idx) => {
        const bar = document.createElement('div');
        bar.className = 'story-progress-bar';
        bar.style.flex = '1';
        bar.style.background = 'rgba(255,255,255,0.3)';
        bar.style.borderRadius = '2px';
        const fill = document.createElement('div');
        fill.className = 'story-progress-fill';
        fill.style.height = '100%';
        fill.style.width = idx < currentStoryIndex ? '100%' : '0%';
        fill.style.background = '#25D366';
        bar.appendChild(fill);
        storiesProgress.appendChild(bar);
      });
    }
  
    function startStoryTimer(){
      clearInterval(storyTimer);
      const current = currentStories[currentStoryIndex];
      duration = (current.tipo === 'video') ? 60000 : STORY_DURATION;
      elapsed = 0;
      const fill = document.querySelectorAll('.story-progress-fill')[currentStoryIndex];
  
      storyTimer = setInterval(()=>{
        if(!paused){
          elapsed += 50;
          fill.style.width = Math.min((elapsed/duration)*100,100)+'%';
          if(elapsed >= duration){
            clearInterval(storyTimer);
            if(currentStoryIndex < currentStories.length-1){
              currentStoryIndex++;
              renderCurrentStory();
            } else closeStories();
          }
        }
      },50);
    }
  
    function renderCurrentStory(){
      storiesCarousel.innerHTML = '';
      currentVideo = null;
      const s = currentStories[currentStoryIndex];
      const content = document.createElement(s.tipo==='video'?'video':'img');
      content.src = s.src;
      content.style.width = '100%';
      content.style.height = '100%';
      content.style.objectFit = 'cover';
      if(s.tipo==='video'){
        content.autoplay = true;
        content.controls = false;
        content.muted = false;
        currentVideo = content;
      }
      storiesCarousel.appendChild(content);
      storiesCaption.textContent = s.legenda || '';
      renderStoryProgress();
      startStoryTimer();
    }
  
    function closeStories(){
      clearInterval(storyTimer);
      storiesModal.classList.add('hidden');
    }
  
    // 🔹 Controles por toque
    let touchStartX = 0;
    let holdTimeout = null;
    let holding = false;
  
    storiesModal.addEventListener('touchstart', e => {
      touchStartX = e.touches[0].clientX;
      // se o usuário segurar mais de 300ms, pausamos o story
      holdTimeout = setTimeout(()=>{
        holding = true;
        paused = true;
        if(currentVideo) currentVideo.pause();
      }, 300);
    });
  
    storiesModal.addEventListener('touchend', e => {
      clearTimeout(holdTimeout);
      const endX = e.changedTouches[0].clientX;
      const diff = endX - touchStartX;
  
      // se estava segurando, apenas retoma
      if(holding){
        holding = false;
        paused = false;
        if(currentVideo) currentVideo.play();
        return;
      }
  
      if(Math.abs(diff) < 40){
        // toque simples: lado direito avança / esquerdo volta
        const rect = storiesModal.getBoundingClientRect();
        const mid = rect.width / 2;
        if(endX > mid){
          if(currentStoryIndex < currentStories.length-1){ 
            currentStoryIndex++; 
            renderCurrentStory(); 
          } else closeStories();
        } else {
          if(currentStoryIndex > 0){
            currentStoryIndex--; 
            renderCurrentStory();
          }
        }
      } else if(diff > 60){
        // deslize direita → esquerda (voltar story)
        if(currentStoryIndex > 0){ currentStoryIndex--; renderCurrentStory(); }
      } else if(diff < -60){
        // deslize esquerda → direita (avançar story)
        if(currentStoryIndex < currentStories.length-1){ currentStoryIndex++; renderCurrentStory(); }
        else closeStories();
      }
    });
  
    storiesBack.onclick = closeStories;
    window.openStories = openStories;
  
  
    //storiesClose.onclick = ()=> storiesModal.classList.add('hidden');
    //storiesPrev.onclick = ()=>{ if(currentStoryIndex>0){ currentStoryIndex--; renderCurrentStory(); } };
    //storiesNext.onclick = ()=>{ if(currentStoryIndex<currentStories.length-1){ currentStoryIndex++; renderCurrentStory(); } };
    
  
     // --- Lista de contatos ---
    function renderList(f=''){
      listEl.innerHTML='';
      contacts
        .filter(c=>(c.name+c.number).toLowerCase().includes(f.toLowerCase()))
        .forEach(renderContact);
    }
  
    // --- Modal adicionar / editar ---
    function openAdd() {
      editingId = null;
      inputName.value = '';
      inputNumber.value = '';
      currentPhoto = './user.png';
      preview.innerHTML = `<img src="./user.png" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
      emojiPicker.style.display = 'none';
      modal.classList.remove('hidden');
    }
  
    function openEdit(id) {
      const c = contacts.find(x => x.id === id);
      if(!c) return;
      editingId = id;
      inputName.value = c.name || '';
      inputNumber.value = c.number || '';
      currentPhoto = c.photo || './user.png';
      if (/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1FAFF}]/u.test(currentPhoto)) {
        preview.textContent = currentPhoto; preview.style.background='#fff';
      } else {
        preview.innerHTML = `<img src="${currentPhoto}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
      }
      emojiPicker.style.display='none';
      modal.classList.remove('hidden');
    }
  
    function toggleFav(id){ const c=contacts.find(x=>x.id===id); if(!c)return; c.fav=!c.fav; save(); renderList(searchInput.value.trim()); }
    function removeContact(id){ if(!confirm('Deseja realmente excluir este contato?')) return; contacts=contacts.filter(x=>x.id!==id); save(); renderList(searchInput.value.trim()); }
    function saveFromModal(){ 
      const name=inputName.value.trim();
      const number=normalizeNumber(inputNumber.value.trim());
      if(!number) return alert('Número inválido');
      const photo=currentPhoto||'./user.png';
      if(editingId){ const c=contacts.find(x=>x.id===editingId); if(c){c.name=name;c.number=number;c.photo=photo;} }
      else contacts.unshift({id:genId(),name,number,photo,fav:false});
      save(); renderList(searchInput.value.trim()); closeModal();
    }
    function closeModal(){ modal.classList.add('hidden'); emojiPicker.style.display='none'; }
  
    function handleFile(ev){
      const file=ev.target.files[0];
      if(!file) return;
      const reader=new FileReader();
      reader.onload=()=>{ currentPhoto=reader.result; preview.innerHTML=`<img src="${reader.result}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`; };
      reader.readAsDataURL(file);
    }
  
    btnPhoto.onclick=()=>photoInput.click();
    photoInput.onchange=handleFile;
    btnEmoji.onclick=()=>emojiPicker.style.display=emojiPicker.style.display==='none'?'flex':'none';
    emojiPicker.querySelectorAll('span').forEach(sp=>{
      sp.addEventListener('click',()=>{
        currentPhoto=sp.textContent;
        preview.textContent=currentPhoto;
        preview.style.background='#fff';
        emojiPicker.style.display='none';
      });
    });
  
    addBtn.onclick=openAdd;
    cancelBtn.onclick=closeModal;
    saveBtn.onclick=saveFromModal;
    searchInput.oninput=()=>renderList(searchInput.value);
    backBtn.onclick=()=>document.getElementById('contacts-app').style.display='none';
  
    // --- Inicialização ---
    load();
    renderList();
    loadNetworking();
})();
</script>



</body>
</html>




